# SPDX-FileCopyrightText: 2021 Helmholtz Centre for Environmental Research (UFZ)
# SPDX-FileCopyrightText: 2021 Helmholtz-Zentrum Dresden-Rossendorf (HZDR)
#
# SPDX-License-Identifier: Apache-2.0

---

- name: Check whether network configurations are given.
  assert:
    that:
      - netplan_ethernets is defined and netplan_ethernets | length > 0

- name: Install netplan packages.
  become: yes
  package:
    name: "{{ netplan_packages }}"
    state: present
    update_cache: yes

- name: Create a netplan config file from template.
  template:
    src: "{{ netplan_configuration_file_template }}"
    dest: "{{ netplan_configuration_file_path }}"
    owner: root
    group: root
    mode: '0644'
  notify:
    - Generate netplan networking
    - Apply netplan networking

- name: Check netplan configuration.
  become: yes
  command:
    cmd: "netplan try -debug â€“config-file {{ netplan_configuration_file_path }}"
  register: check_netplan_config
  changed_when: check_netplan_config.rc != 0
  failed_when: check_netplan_config.rc != 0

...
